@page "/admin/page/edit/{id:guid?}"
@using Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewBag.Title = "Edit Page";
    ViewBag.XData = "pageEditor";
    ViewBag.HideAdminSidebar = true;
    ViewBag.AdminBackUrl = "/admin/page";
}

@section scripts {
    <partial name="_MonacoLoaderScript" />
    <script type="module" src="~/js/app/admin.editpage.mjs"></script>
}

@section navbarActions {
    <li class="nav-item">
        <button type="button" class="btn btn-sm btn-outline-light my-1 me-2"
                data-bs-toggle="offcanvas" data-bs-target="#pageSettingsCanvas"
                aria-controls="pageSettingsCanvas">
            <i class="bi-sliders me-1"></i>
            @SharedLocalizer["Settings"]
        </button>
    </li>
}

@Html.AntiForgeryToken()

<div x-show="isLoading" class="text-muted p-3" :class="{ 'd-flex align-items-center': isLoading }">
    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
    <span>Loading page data...</span>
</div>

<div x-show="!isLoading" x-cloak class="page-editor-container d-flex flex-column">
    <form id="page-edit-form" x-on:submit.prevent="handleSubmit" class="d-flex flex-column flex-grow-1">
        <div class="page-editor-header px-3 pt-2">
            <input type="text"
                   x-model="formData.title"
                   class="form-control form-control-lg mb-1"
                   placeholder="Title"
                   required />

            <div class="input-group input-group-sm">
                <label class="input-group-text">
                    <i class="bi-link-45deg"></i>
                </label>
                <input type="text"
                       x-model="formData.slug"
                       class="form-control form-control-sm"
                       placeholder="Slug"
                       required />
            </div>
        </div>

        <div class="page-editor-tabs px-3 pt-2">
            <ul class="nav nav-tabs mb-0" id="editor-box-tabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active"
                       id="profile-tab"
                       data-bs-toggle="tab"
                       href="#rawhtmlcontent-editor-box"
                       role="tab"
                       aria-controls="html"
                       aria-selected="true">HTML</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link"
                       id="csscontent-tab"
                       data-bs-toggle="tab"
                       href="#csscontent-editor-box"
                       role="tab"
                       aria-controls="css"
                       aria-selected="false">CSS</a>
                </li>
            </ul>
        </div>

        <div class="tab-content flex-grow-1 px-3">
            <div class="tab-pane active h-100"
                 id="rawhtmlcontent-editor-box"
                 role="tabpanel"
                 aria-labelledby="html-tab">
                <div id="RawHtmlContentEditor" class="monaco-target"></div>
                <textarea x-model="formData.rawHtmlContent"
                          class="page-rawhtmlcontent-textarea d-none"></textarea>
            </div>
            <div class="tab-pane h-100"
                 id="csscontent-editor-box"
                 role="tabpanel"
                 aria-labelledby="css-tab">
                <div id="CssContentEditor" class="monaco-target"></div>
                <textarea x-model="formData.cssContent"
                          class="page-csscontent-textarea d-none"></textarea>
            </div>
        </div>

        <div class="page-editor-footer px-3 py-2 border-top bg-gray-1">
            <button type="submit"
                    class="btn btn-outline-accent"
                    id="btn-submit"
                    x-bind:disabled="isSaving"
                    x-on:click="isPreview = false">
                <span x-show="!isSaving">@SharedLocalizer["Save"]</span>
                <span x-show="isSaving">Saving...</span>
            </button>
            <button type="submit"
                    class="btn btn-outline-success"
                    id="btn-preview"
                    x-show="!formData.isPublished"
                    x-bind:disabled="isSaving"
                    x-on:click="isPreview = true">
                @SharedLocalizer["Preview"]
            </button>
        </div>
    </form>
</div>

<div class="offcanvas offcanvas-end" tabindex="-1" id="pageSettingsCanvas" x-ref="settingsCanvas" aria-labelledby="pageSettingsCanvasLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="pageSettingsCanvasLabel">@SharedLocalizer["Settings"]</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <div class="mb-3">
            <div class="form-check form-switch mb-2">
                <input type="checkbox"
                       x-model="formData.hideSidebar"
                       class="form-check-input"
                       id="hideSidebar">
                <label for="hideSidebar" class="form-check-label">Hide Sidebar</label>
            </div>
            <div class="form-check form-switch mb-2">
                <input type="checkbox"
                       x-model="formData.isPublished"
                       class="form-check-input"
                       id="isPublished">
                <label for="isPublished" class="form-check-label">Published</label>
            </div>
        </div>
        <div class="border-top pt-3">
            <div class="form-floating">
                <textarea x-model="formData.metaDescription"
                          placeholder="Meta Description"
                          class="form-control form-control-sm h-200px"
                          spellcheck="false"
                          required
                          id="metaDescription"></textarea>
                <label class="form-label" for="metaDescription">Meta Description</label>
            </div>
        </div>
    </div>
</div>